@inherits LayoutComponentBase
@inject SkyNet.Simulator.Dashboard.Services.ThemeService ThemeService

<div class="page">
    @* Sidebar removed; nav is now in the top bar *@

    <main>
        <div class="top-row px-4">
            <div class="top-nav">
                <a class="top-brand" href="">SkyNet.Simulator.Dashboard</a>
                <NavMenu />
            </div>

            <div class="top-links">
                <button type="button" class="btn btn-sm @(_isDark ? "btn-outline-light" : "btn-outline-info")" @onclick="ToggleTheme">
                    @(_isDark ? "Light mode" : "Dark mode")
                </button>
                <a href="about">About</a>
            </div>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private bool _isDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }

        var theme = await ThemeService.GetAsync();
        _isDark = string.Equals(theme, "dark", StringComparison.OrdinalIgnoreCase);
        StateHasChanged();
    }

    private async Task ToggleTheme()
    {
        var theme = await ThemeService.ToggleAsync();
        _isDark = string.Equals(theme, "dark", StringComparison.OrdinalIgnoreCase);
    }
}
